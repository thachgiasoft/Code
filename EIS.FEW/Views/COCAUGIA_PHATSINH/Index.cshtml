@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_mainLayout.cshtml";
}

@section HeadResources{
    @Html.Partial("HeadResourcesPartial")
}

@model EIS.FEW.Models.COCAUGIA_DICHVU

<script type="text/javascript">
    function FilterChiTiet(s, e) {
        if (gridviewDanhSach.pageRowCount > 0) {
            gridviewChiTiet.PerformCallback({ nhomdvId: gridviewDanhSach.GetRowKey(gridviewDanhSach.GetFocusedRowIndex()) });
            //gridviewChiTiet.ExpandAll();
        }
    }

    // Sự kiện bấm nút tìm kiếm trên giao diện lọc
    function Filter() {
        console.log(txt_ngay_ra.GetDate().toString("dd/MM/yyyy"));

        gridviewChiTiet.PerformCallback({
            maCskcb: cbo_cskcb.GetValue(),
            maThe: txt_ma_the.GetValue(),
            ngayVao: txt_ngay_vao.GetText(),
            ngayRa: txt_ngay_ra.GetText(),
            maDichVu: txt_ma_dich_vu.GetValue()
        });
    }

    // Tính toán lại giá trị tổng tiền
    function OnBatchEditEndEditing(s, e) {
        window.setTimeout(function () {
            var donGiaOld = s.batchEditApi.GetCellValue(e.visibleIndex, "DONGIA_OLD");
            var soLuongOld = s.batchEditApi.GetCellValue(e.visibleIndex, "SO_LUONG_OLD");
            s.batchEditApi.SetCellValue(e.visibleIndex, "THANH_TIEN_OLD", donGiaOld * soLuongOld, null, true);

            var donGiaNew = s.batchEditApi.GetCellValue(e.visibleIndex, "DONGIA_NEW");
            var soLuongNew = s.batchEditApi.GetCellValue(e.visibleIndex, "SO_LUONG_NEW");
            s.batchEditApi.SetCellValue(e.visibleIndex, "THANH_TIEN_NEW", donGiaNew * soLuongNew, null, true);

            s.batchEditApi.SetCellValue(e.visibleIndex, "CHENH_LECH", donGiaNew * soLuongNew - donGiaOld * soLuongOld, null, true);
        }, 10);
    }

    function Save() {
        gridviewChiTiet.UpdateEdit();
    }
</script>
@Html.DevExpress().RoundPanel(settings =>
{
    settings.Name = "roundPanel";
    settings.AllowCollapsingByHeaderClick = true;
    settings.ShowCollapseButton = true;
    settings.EnableAnimation = true;
    settings.Width = Unit.Percentage(100);
    settings.HeaderText = "NHẬP CƠ CẤU THỰC TẾ";
    settings.Height = Unit.Pixel(50);
    settings.SetContent(() =>
    {
        Html.RenderPartial("FilterView", Model.Filter);
    });
}).GetHtml()

@Html.DevExpress().Splitter(
    settings =>
    {
        settings.Name = "splClientSideEvents";
        settings.FullscreenMode = true;
        settings.Width = Unit.Percentage(100);
        settings.Orientation = Orientation.Horizontal;
        settings.ShowCollapseBackwardButton = true;
        settings.ShowCollapseForwardButton = true;

        
        settings.Panes.Add(pane =>
        {
            pane.Name = "GvChiTietDichVu";
            pane.Size = Unit.Percentage(100);
            pane.SetContent(() => Html.RenderPartial("_ThemChiTietPartial"));
        });
    }).GetHtml()